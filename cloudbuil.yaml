steps:
- id: "Rodando docker-compose"
  name: 'gcr.io/$PROJECT_ID/docker-compose:1.24.0'
  args: ['-f','docker-compose.cloudbuild.yaml','up','-d']

- id: "Rodando composer"
  name: 'gcr.io/cloud-builders/docker'
  args: ['exec','-t','app','composer','install']

- id: "Building image from Dockerfile.prod"
  name: 'gcr.io/cloud-builders/docker'
  args: ['build','-t','gcr.io/$PROJECT_ID/go-ci:$SHORT_SHA','-f','/Dockerfile','.'] # O $SHORT_SHA Ã© para gerar um nome de imagem diferente para cada imagem baseado no commit  

- id: "Pushing image"  
  name: 'gcr.io/cloud-builders/docker'
  args: ['push','gcr.io/$PROJECT_ID/go-ci:$SHORT_SHA']

